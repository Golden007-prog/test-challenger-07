<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQ Challenge | Tech Quiz</title>
    <meta name="description" content="Test your technical knowledge with our modern MCQ challenge. 3 rounds, 50 questions each.">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" id="closeSettingsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- GitHub Section -->
                <div class="settings-section">
                    <h3>üîê GitHub Cloud Sync</h3>
                    <p class="settings-desc">Sync your scores across devices using GitHub.</p>
                    
                    <div id="githubLoggedOut" class="auth-section">
                        <input type="password" id="githubTokenInput" placeholder="Enter GitHub Personal Access Token" class="settings-input">
                        <p class="settings-help">
                            <a href="https://github.com/settings/tokens/new?scopes=gist&description=MCQ%20Quiz%20App" target="_blank" rel="noopener">
                                Get a token here
                            </a> (check "gist" scope only)
                        </p>
                        <button class="btn btn-primary" id="githubLoginBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.335-1.755-1.335-1.755-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.605-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/>
                            </svg>
                            <span>Connect GitHub</span>
                        </button>
                    </div>

                    <div id="githubLoggedIn" class="auth-section" style="display: none;">
                        <div class="user-info">
                            <img id="githubAvatar" src="" alt="Avatar" class="user-avatar">
                            <div class="user-details">
                                <span class="user-name" id="githubUsername">Username</span>
                                <span class="sync-status" id="syncStatusText">‚úì Synced</span>
                            </div>
                        </div>
                        <button class="btn btn-outline btn-danger" id="githubLogoutBtn">Logout</button>
                    </div>
                </div>

                <!-- Gemini Section -->
                <div class="settings-section">
                    <h3>ü§ñ AI Analysis (Gemini)</h3>
                    <p class="settings-desc">Get AI-powered insights on your performance.</p>
                    
                    <div id="geminiNotConfigured" class="auth-section">
                        <input type="password" id="geminiKeyInput" placeholder="Enter Gemini API Key" class="settings-input">
                        <p class="settings-help">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">
                                Get a key from Google AI Studio
                            </a>
                        </p>
                        <button class="btn btn-primary" id="geminiSaveBtn">
                            <span>Save API Key</span>
                        </button>
                    </div>

                    <div id="geminiConfigured" class="auth-section" style="display: none;">
                        <div class="config-status">
                            <span class="status-icon">‚úì</span>
                            <span>Gemini API configured</span>
                        </div>
                        <button class="btn btn-outline btn-danger" id="geminiClearBtn">Remove Key</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Landing Screen -->
    <section id="landing" class="screen active">
        <div class="container">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="sync-indicator" id="syncIndicator" style="display: none;">
                    <span class="sync-icon">‚òÅÔ∏è</span>
                    <span id="syncLabel">Synced</span>
                </div>
                <button class="btn btn-icon" id="settingsBtn" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>

            <div class="logo">MCQ</div>
            <h1 class="title">Tech Challenge</h1>
            <p class="subtitle">Test your knowledge across 3 rounds of 50 questions each</p>
            
            <div class="stats-preview" id="statsPreview">
                <div class="stat-item">
                    <span class="stat-label">Last Accuracy</span>
                    <span class="stat-value" id="lastAccuracy">--</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <span class="stat-label">Best Score</span>
                    <span class="stat-value" id="bestScore">--</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <span class="stat-label">Attempts</span>
                    <span class="stat-value" id="totalAttempts">0</span>
                </div>
            </div>

            <div class="loading-status" id="loadingStatus">
                <div class="spinner"></div>
                <span>Loading questions from PDFs...</span>
            </div>

            <div class="question-count" id="questionCount" style="display: none;">
                <span id="totalQuestions">0</span> questions loaded
            </div>

            <button class="btn btn-primary" id="startBtn" disabled>
                <span>Begin Challenge</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>

            <button class="btn btn-secondary" id="refreshBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
                <span>Refresh Questions</span>
            </button>
        </div>
    </section>

    <!-- Quiz Screen -->
    <section id="quiz" class="screen">
        <header class="quiz-header">
            <div class="round-info">
                <span class="round-label">Round</span>
                <span class="round-number" id="currentRound">1</span>
                <span class="round-total">/ 3</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <span class="progress-text" id="progressText">1 / 50</span>
            </div>
            <div class="timer-info">
                <span class="timer-label">Time</span>
                <span class="timer-value" id="totalTimer">00:00</span>
            </div>
            <div class="score-info">
                <span class="score-label">Score</span>
                <span class="score-value" id="currentScore">0</span>
            </div>
        </header>

        <main class="quiz-main">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">Q1</div>
                    <div class="question-timer" id="questionTimer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span id="questionTime">0s</span>
                    </div>
                </div>
                <p class="question-text" id="questionText">Loading question...</p>
            </div>

            <div class="options-container" id="optionsContainer">
                <!-- Options will be inserted here -->
            </div>

            <div class="quiz-actions">
                <button class="btn btn-outline" id="skipBtn">
                    Skip
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </main>

        <footer class="quiz-footer">
            <div class="accuracy-tracker">
                <div class="accuracy-item">
                    <span class="accuracy-label">Previous</span>
                    <span class="accuracy-value" id="prevAccuracy">--</span>
                </div>
                <div class="accuracy-arrow">‚Üí</div>
                <div class="accuracy-item current">
                    <span class="accuracy-label">Current</span>
                    <span class="accuracy-value" id="currAccuracy">0%</span>
                </div>
            </div>
        </footer>
    </section>

    <!-- Round Complete Screen -->
    <section id="roundComplete" class="screen">
        <div class="container">
            <div class="round-complete-icon">‚úì</div>
            <h2 class="round-complete-title">Round <span id="completedRound">1</span> Complete</h2>
            
            <div class="round-stats">
                <div class="round-stat">
                    <span class="round-stat-value" id="roundScore">0</span>
                    <span class="round-stat-label">Correct</span>
                </div>
                <div class="round-stat">
                    <span class="round-stat-value" id="roundAccuracy">0%</span>
                    <span class="round-stat-label">Accuracy</span>
                </div>
                <div class="round-stat">
                    <span class="round-stat-value" id="roundTime">0:00</span>
                    <span class="round-stat-label">Time</span>
                </div>
            </div>

            <button class="btn btn-primary" id="nextRoundBtn">
                <span>Start Round <span id="nextRoundNum">2</span></span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- Final Results Screen -->
    <section id="results" class="screen">
        <div class="container results-container">
            <h2 class="results-title">Challenge Complete</h2>
            
            <div class="results-summary">
                <div class="results-main">
                    <div class="results-score" id="finalScore">0</div>
                    <div class="results-total">/ 150</div>
                </div>
                <div class="results-accuracy" id="finalAccuracy">0%</div>
                <div class="results-time">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span id="finalTime">0:00</span>
                </div>
            </div>

            <div class="results-breakdown">
                <h3>Round Breakdown</h3>
                <div class="breakdown-list" id="breakdownList">
                    <!-- Round breakdowns will be inserted here -->
                </div>
            </div>

            <div class="results-comparison">
                <div class="comparison-item">
                    <span class="comparison-label">Previous Best</span>
                    <span class="comparison-value" id="previousBest">--</span>
                </div>
                <div class="comparison-vs">vs</div>
                <div class="comparison-item">
                    <span class="comparison-label">This Attempt</span>
                    <span class="comparison-value" id="thisAttempt">--</span>
                </div>
            </div>

            <!-- AI Analysis Section -->
            <div class="ai-analysis-section" id="aiAnalysisSection">
                <div class="ai-analysis-header">
                    <h3>ü§ñ AI Performance Analysis</h3>
                    <button class="btn btn-sm btn-outline" id="reanalyzeBtn" style="display: none;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                        </svg>
                        Re-analyze
                    </button>
                </div>
                <div class="ai-analysis-content" id="aiAnalysisContent">
                    <div class="analysis-loading" id="analysisLoading" style="display: none;">
                        <div class="spinner"></div>
                        <span>Analyzing your performance...</span>
                    </div>
                    <div class="analysis-result" id="analysisResult" style="display: none;">
                        <!-- Analysis will be rendered here -->
                    </div>
                    <div class="analysis-unavailable" id="analysisUnavailable">
                        <p>AI analysis requires a Gemini API key.</p>
                        <button class="btn btn-outline btn-sm" id="setupGeminiBtn">Configure in Settings</button>
                    </div>
                </div>
            </div>

            <div class="results-actions">
                <button class="btn btn-primary" id="retryBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    <span>Try Again</span>
                </button>
                <button class="btn btn-outline" id="homeBtn">
                    <span>Back to Home</span>
                </button>
            </div>
        </div>
    </section>

    <script src="pdfParser.js"></script>
    <script src="githubAuth.js"></script>
    <script src="scoreTracker.js"></script>
    <script src="geminiAnalyzer.js"></script>
    <script src="app.js"></script>
</body>
</html>
